<h2>Characters</h2>

<table class="styled-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Level</th>
      <th>Realm</th>
      <th>Race</th>
      <th>Class</th>
      <th>Faction</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    @if (characterService.loadingSignal()) {
      <tr>Loading characters...</tr>
    }
    @if (characterService.errorSignal()) {
      <tr>Error: {{ characterService.errorSignal() }}</tr>
    }
    @if (!characterService.loadingSignal() && !characterService.errorSignal() && characterService.characterDisplayDtosSignal().length > 0) {
      @for (char of characterService.characterDisplayDtosSignal(); track char.id) {
        <tr (click)="onSelect(char)" [class.selected]="selectedCharacterIdSignal() === char.id">
          <td><strong [ngClass]="getFactionClass(char.factionName)">{{ char.name | titlecase }}</strong></td>
          <td>{{ char.level }}</td>
          <td>{{ char.realmName }}</td>
          <td>{{ char.raceName }}</td>
          <td>{{ char.className }}</td>
          <td>{{ char.factionName }}</td>
          <td><button class="delete-button" (click)="deleteCharacter(char.id)">X</button></td>
        </tr>
      }
    }
    @if (!characterService.loadingSignal() && !characterService.errorSignal() && characterService.characterDisplayDtosSignal().length === 0) {
      <tr>No characters found.</tr>
    }
  </tbody>
</table>

<!-- Logout button component -->
<div class="logout-button">
  <app-logout-button></app-logout-button>
</div>

<!-- Edit form appears when a character is selected -->
@if (selectedCharacterIdSignal()) {
  <app-character-edit 
    [characterId]="selectedCharacterIdSignal()!"
    (cancel)="selectedCharacterIdSignal.set(null)">
  </app-character-edit>
}
