<h2>Characters</h2>

<!-- Loading indicator -->
@if (characterService.loadingSignal()) {
  <div class="center-message loading">Loading characters...</div>
}

<!-- Error banner -->
@if (characterService.errorSignal()) {
  <div class="center-message alert alert-danger" role="alert">
    {{ characterService.errorSignal() }}
    <div>
      <button class="retry-btn" (click)="retryGetCharacters()">Retry</button>
    </div>
  </div>
}

<table class="styled-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Level</th>
      <th>Realm</th>
      <th>Race</th>
      <th>Class</th>
      <th>Faction</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    <!-- Skeletons while loading -->
    @if (characterService.loadingSignal()) {
      @for (_ of [].constructor(5); track $index) {
        <tr>
          <td colspan="7">
            <div class="skeleton-row"></div>
          </td>
        </tr>
      }
    }
    <!-- Error row (in addition to global alert) -->
    @else if (characterService.errorSignal()) {
      <tr>
        <td colspan="7" class="error-cell">
          Failed to load characters. Please try again.
        </td>
      </tr>
    }
    <!-- Character list only shows if no error and not loading -->
    @else {
      @for (char of characterService.characterDisplayDtosSignal(); track char.id) {
        <tr (click)="onSelect(char)" [class.selected]="selectedCharacterIdSignal() === char.id">
          <td><strong [ngClass]="getFactionClass(char.factionName)">{{ char.name | titlecase }}</strong></td>
          <td>{{ char.level }}</td>
          <td>{{ char.realmName }}</td>
          <td>{{ char.raceName }}</td>
          <td>{{ char.className }}</td>
          <td>{{ char.factionName }}</td>
          <td><button class="delete-button" (click)="deleteCharacter(char.id)">X</button></td>
        </tr>
      }
    }
    @if (!characterService.loadingSignal() && !characterService.errorSignal() && characterService.characterDisplayDtosSignal().length === 0) {
      <tr>No characters found.</tr>
    }
  </tbody>
</table>

<!-- âœ… Logout button component -->
<div class="logout-button">
  <app-logout-button></app-logout-button>
</div>


<!-- Edit form appears when a character is selected -->
@if (selectedCharacterIdSignal()) {
  <app-character-edit 
    [characterId]="selectedCharacterIdSignal()!"
    (cancel)="onSelect(null)">
  </app-character-edit>
}
